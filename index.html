<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collection</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: white;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            height: 100vh;
            position: relative;
        }

        .nav {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            display: flex;
            gap: 15px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 20px;
            border-radius: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .nav a {
            text-decoration: none;
            color: #333;
            font-size: 0.9rem;
            padding: 8px 16px;
            border-radius: 20px;
            transition: all 0.3s;
            font-weight: 500;
        }

        .nav a:hover {
            background: #f0f0f0;
            color: #000;
        }

        .logo-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 100;
            text-align: center;
        }

        .logo {
            max-width: 400px;
            width: 80vw;
            height: auto;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
        }

        .floating-product {
            position: absolute;
            cursor: pointer;
            transition: transform 0.3s ease;
            animation: float 20s infinite ease-in-out;
        }

        .floating-product:hover {
            transform: scale(1.1) !important;
            z-index: 50;
        }

        .floating-product img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        @keyframes float {
            0%, 100% {
                transform: translate(0, 0) rotate(0deg);
            }
            25% {
                transform: translate(30px, -30px) rotate(5deg);
            }
            50% {
                transform: translate(-20px, 20px) rotate(-5deg);
            }
            75% {
                transform: translate(20px, 30px) rotate(3deg);
            }
        }

        @media (max-width: 768px) {
            .logo {
                max-width: 280px;
            }
            
            .nav {
                flex-wrap: wrap;
                justify-content: center;
                max-width: 90vw;
            }
        }
    </style>
</head>
<body>
    <nav class="nav" id="nav">
        <a href="catalogue-api.html">Tous les produits</a>
    </nav>

    <div class="logo-container">
        <img src="https://raw.githubusercontent.com/jia999999/CommedesArchives/main/COMMEdesARCHIVES_LOGO.png" 
             alt="Logo" class="logo"
             onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
        
        <h1 style="display: none; font-size: 4rem; font-weight: 300; color: #000;">
            COLLECTION

    <div id="floatingProducts"></div>

    <script>
        let products = [];

        async function loadProducts() {
            try {
                const result = await window.storage.get('appsheet-products');
                if (result && result.value) {
                    products = JSON.parse(result.value);
                    createFloatingProducts();
                    createNavigation();
                }
            } catch (error) {
                console.log('Aucune donnée trouvée');
            }
        }

        function createNavigation() {
            const gammes = [...new Set(products.map(p => p.gamme).filter(Boolean))];
            const nav = document.getElementById('nav');
            
            gammes.forEach(gamme => {
                const link = document.createElement('a');
                link.href = `catalogue-api.html?gamme=${encodeURIComponent(gamme)}`;
                link.textContent = gamme;
                nav.appendChild(link);
            });
        }

        function createFloatingProducts() {
            const container = document.getElementById('floatingProducts');
            const productsWithImages = products.filter(p => p.pic_1);
            
            // Mélanger aléatoirement
            const shuffled = productsWithImages.sort(() => Math.random() - 0.5);
            
            // Limiter le nombre pour ne pas surcharger
            const count = Math.min(shuffled.length, 25);
            
            for (let i = 0; i < count; i++) {
                const product = shuffled[i];
                const div = document.createElement('div');
                div.className = 'floating-product';
                
                // Taille aléatoire
                const size = Math.random() * 120 + 80; // Entre 80 et 200px
                div.style.width = size + 'px';
                div.style.height = size + 'px';
                
                // Position aléatoire en évitant le centre
                let x, y;
                do {
                    x = Math.random() * (window.innerWidth - size);
                    y = Math.random() * (window.innerHeight - size);
                } while (
                    x > window.innerWidth * 0.3 && x < window.innerWidth * 0.7 &&
                    y > window.innerHeight * 0.3 && y < window.innerHeight * 0.7
                );
                
                div.style.left = x + 'px';
                div.style.top = y + 'px';
                
                // Animation aléatoire
                div.style.animationDelay = (Math.random() * 10) + 's';
                div.style.animationDuration = (Math.random() * 15 + 15) + 's';
                
                // Opacité aléatoire
                div.style.opacity = Math.random() * 0.4 + 0.4; // Entre 0.4 et 0.8
                
                const img = document.createElement('img');
                img.src = product.pic_1;
                img.alt = product.name || product.code;
                
                div.appendChild(img);
                div.onclick = () => {
                    window.location.href = `catalogue-api.html?id=${product.id}`;
                };
                
                container.appendChild(div);
            }
        }

        // Charger au démarrage
        loadProducts();

        // Recharger les positions au redimensionnement
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                document.getElementById('floatingProducts').innerHTML = '';
                createFloatingProducts();
            }, 250);
        });
    </script>
</body>
</html>
